<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Finance Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="./app.js" defer></script>
  </head>
  <body>
    <header class="app-header">
      <div class="container header-inner">
        <div class="brand">
          <span class="brand-logo">₽</span>
          <span class="brand-name">Finance Tracker</span>
        </div>
        <nav class="nav" aria-label="Основная навигация">
          <button class="nav-link active" data-section="dashboard">Дашборд</button>
          <button class="nav-link" data-section="entries">Операции</button>
          <button class="nav-link" data-section="budgets">Бюджеты</button>
          <button class="nav-link" data-section="debts">Долги</button>
          <button class="nav-link" data-section="recurring">Повторения</button>
          <button class="nav-link" data-section="settings">Настройки</button>
        </nav>
        <div class="auth-box" id="auth-box">
          <a id="btn-login" class="btn btn-secondary" href="/auth/google">Войти с Google</a>
          <div id="user-box" class="user-box hidden">
            <img id="user-pic" alt="" />
            <span id="user-name"></span>
            <button id="btn-logout" class="btn btn-secondary" type="button">Выйти</button>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <!-- Dashboard -->
      <section id="dashboard" class="section visible" aria-labelledby="dashboard-title">
        <h2 id="dashboard-title">Дашборд</h2>
        <div class="cards">
          <div class="card">
            <div class="card-title">Доходы (период)</div>
            <div class="card-value" id="dash-income">0</div>
          </div>
          <div class="card">
            <div class="card-title">Расходы (период)</div>
            <div class="card-value" id="dash-expense">0</div>
          </div>
          <div class="card">
            <div class="card-title">Баланс (период)</div>
            <div class="card-value" id="dash-balance">0</div>
          </div>
          <div class="card">
            <div class="card-title">Ежедневный бюджет</div>
            <div class="card-value" id="dash-daily">0</div>
            <div class="card-sub" id="dash-days-left"></div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <h3>Расходы по категориям (текущий период)</h3>
            <div class="panel-actions">
              <input type="month" id="dash-month-filter" aria-label="Месяц" />
              <button id="dash-reset-month" class="btn btn-secondary">Текущий</button>
            </div>
          </div>
          <canvas id="categoryChart" height="120"></canvas>
        </div>
      </section>

      <!-- Entries -->
      <section id="entries" class="section" aria-labelledby="entries-title">
        <h2 id="entries-title">Операции</h2>

        <div class="panel">
          <div class="panel-header"><h3>Добавить операцию</h3></div>
          <form id="entry-form" class="form-grid">
            <div class="form-row">
              <label for="entry-type">Тип</label>
              <div class="segmented">
                <input type="radio" id="type-income" name="type" value="income" checked />
                <label for="type-income">Доход</label>
                <input type="radio" id="type-expense" name="type" value="expense" />
                <label for="type-expense">Расход</label>
              </div>
            </div>
            <div class="form-row">
              <label for="entry-amount">Сумма</label>
              <input id="entry-amount" name="amount" type="number" min="0" step="0.01" required />
            </div>
            <div class="form-row">
              <label for="entry-category">Категория</label>
              <input id="entry-category" name="category" list="category-suggestions" required />
              <datalist id="category-suggestions"></datalist>
            </div>
            <div class="form-row">
              <label for="entry-date">Дата</label>
              <input id="entry-date" name="date" type="date" required />
            </div>
            <div class="form-row">
              <label for="entry-note">Заметка</label>
              <input id="entry-note" name="note" type="text" placeholder="Необязательно" />
            </div>
            <div class="form-row form-row-actions">
              <button class="btn" type="submit">Добавить</button>
              <button class="btn btn-secondary" type="reset">Сброс</button>
            </div>
          </form>
        </div>

        <div class="panel">
          <div class="panel-header">
            <h3>Список операций</h3>
            <div class="panel-actions">
              <select id="entries-type-filter" aria-label="Тип">
                <option value="all">Все</option>
                <option value="income">Доходы</option>
                <option value="expense">Расходы</option>
              </select>
              <input type="month" id="entries-month-filter" />
              <button id="entries-reset-filters" class="btn btn-secondary">Сбросить</button>
            </div>
          </div>
          <div class="table-wrap">
            <table class="table" id="entries-table" aria-describedby="entries-title">
              <thead>
                <tr>
                  <th>Дата</th>
                  <th>Тип</th>
                  <th>Категория</th>
                  <th>Сумма</th>
                  <th>Заметка</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Budgets -->
      <section id="budgets" class="section" aria-labelledby="budgets-title">
        <h2 id="budgets-title">Бюджеты</h2>

        <div class="panel">
          <div class="panel-header"><h3>Добавить бюджет (месячный)</h3></div>
          <form id="budget-form" class="form-grid">
            <div class="form-row">
              <label for="budget-category">Категория</label>
              <input id="budget-category" name="category" list="category-suggestions" required />
            </div>
            <div class="form-row">
              <label for="budget-amount">План, ₽</label>
              <input id="budget-amount" name="amount" type="number" min="0" step="0.01" required />
            </div>
            <div class="form-row form-row-actions">
              <button class="btn" type="submit">Сохранить</button>
            </div>
          </form>
        </div>

        <div class="panel">
          <div class="panel-header"><h3>План vs Факт (текущий период)</h3></div>
          <div id="budgets-list" class="budgets-list"></div>
        </div>
      </section>

      <!-- Debts -->
      <section id="debts" class="section" aria-labelledby="debts-title">
        <h2 id="debts-title">Долги</h2>

        <div class="panel">
          <div class="panel-header"><h3>Добавить долг</h3></div>
          <form id="debt-form" class="form-grid">
            <div class="form-row">
              <label for="debt-direction">Тип</label>
              <select id="debt-direction" required>
                <option value="borrowed">Я занял(а)</option>
                <option value="lent">Я одолжил(а)</option>
              </select>
            </div>
            <div class="form-row">
              <label for="debt-person">Контрагент</label>
              <input id="debt-person" type="text" required />
            </div>
            <div class="form-row">
              <label for="debt-amount">Сумма</label>
              <input id="debt-amount" type="number" min="0" step="0.01" required />
            </div>
            <div class="form-row">
              <label for="debt-date">Дата</label>
              <input id="debt-date" type="date" required />
            </div>
            <div class="form-row">
              <label for="debt-due">Срок</label>
              <input id="debt-due" type="date" />
            </div>
            <div class="form-row">
              <label for="debt-note">Заметка</label>
              <input id="debt-note" type="text" placeholder="Необязательно" />
            </div>
            <div class="form-row form-row-actions">
              <button class="btn" type="submit">Сохранить</button>
            </div>
          </form>
        </div>

        <div class="panel">
          <div class="panel-header"><h3>Список долгов</h3></div>
          <div id="debts-list" class="debts-list"></div>
        </div>
      </section>

      <!-- Recurring -->
      <section id="recurring" class="section" aria-labelledby="recurring-title">
        <h2 id="recurring-title">Повторяющиеся операции</h2>

        <div class="panel">
          <div class="panel-header"><h3>Добавить повторение</h3></div>
          <form id="recurring-form" class="form-grid">
            <div class="form-row">
              <label for="rec-type">Тип</label>
              <select id="rec-type" required>
                <option value="expense">Расход</option>
                <option value="income">Доход</option>
              </select>
            </div>
            <div class="form-row">
              <label for="rec-category">Категория</label>
              <input id="rec-category" list="category-suggestions" required />
            </div>
            <div class="form-row">
              <label for="rec-amount">Сумма</label>
              <input id="rec-amount" type="number" min="0" step="0.01" required />
            </div>
            <div class="form-row">
              <label for="rec-frequency">Периодичность</label>
              <select id="rec-frequency">
                <option value="monthly">Ежемесячно</option>
                <option value="weekly">Еженедельно</option>
              </select>
            </div>
            <div class="form-row">
              <label for="rec-start">Начало</label>
              <input id="rec-start" type="date" required />
            </div>
            <div class="form-row">
              <label for="rec-end">Окончание</label>
              <input id="rec-end" type="date" />
            </div>
            <div class="form-row form-row-actions">
              <button class="btn" type="submit">Сохранить</button>
              <button class="btn btn-secondary" id="rec-post-now" type="button">Добавить за текущий период</button>
            </div>
          </form>
        </div>

        <div class="panel">
          <div class="panel-header"><h3>Список повторений</h3></div>
          <div id="recurring-list" class="recurring-list"></div>
        </div>
      </section>

      <!-- Settings -->
      <section id="settings" class="section" aria-labelledby="settings-title">
        <h2 id="settings-title">Настройки</h2>

        <div class="panel">
          <div class="panel-header"><h3>Общие</h3></div>
          <form id="settings-form" class="form-grid">
            <div class="form-row">
              <label for="set-payday">День зарплаты</label>
              <input id="set-payday" type="number" min="1" max="28" required />
            </div>
            <div class="form-row">
              <label for="set-credit">Кредитный лимит</label>
              <input id="set-credit" type="number" min="0" step="0.01" />
            </div>
            <div class="form-row">
              <label for="set-currency">Валюта</label>
              <input id="set-currency" type="text" maxlength="5" placeholder="₽, ₸, $, €" />
            </div>
            <div class="form-row form-row-actions">
              <button class="btn" type="submit">Сохранить</button>
            </div>
          </form>
        </div>

        <div class="panel">
          <div class="panel-header"><h3>Данные</h3></div>
          <div class="settings-row">
            <button id="btn-export" class="btn">Экспорт JSON</button>
            <label class="btn btn-secondary" for="import-file">Импорт JSON</label>
            <input id="import-file" type="file" accept="application/json" hidden />
            <button id="btn-reset" class="btn btn-danger">Сбросить всё</button>
          </div>
          <textarea id="export-output" class="export-output" rows="8" readonly></textarea>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="container">
        <span>© Finance Tracker</span>
      </div>
    </footer>
  </body>
</html>
